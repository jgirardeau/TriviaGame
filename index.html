<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="UTF-8">
    <title>Space Trivia</title>
    <link rel="stylesheet" type="text/css" href="assets/css/reset.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
</head>

<body>
    <h1 id="space_trivia">Space Trivia</h1>

    <div class="container">
        <div class="row">
            <div class="col-md-4">
            </div>
            <div class="col-md-6">
                <div id="display">Time left: 59</div>
                <div id="correct">Correct: 0</div>
                <div id="incorrect">Misses: 0</div>
                <div id="notAnswered">Unanswered: 0</div>
            </div>
            <div class="col-md-2">
            </div>
        </div>
        <div class="row">
            <div class="col-md-2">
            </div>
            <div class="col-md-8" id="questions">
            </div>
            <div class="col-md-2">
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
            </div>
            <button id="submit">Submit</button>
        </div>
        <div class="col-md-2">
        </div>
    </div>
    </div>

    <script src="gamefacts.js"></script>
    <script>
        var game_running = false;
        var correct = 0;
        var incorrect = 0;
        var missing = 0;
        var game_started = false;
        var time_left;
        var game_time = 59;
        var intervalId;
        // random 0 to max-1
        function make_random(max) {
            return Math.floor(Math.random() * (max));
        }
        // build game html
        for (var i = 0; i < gameFacts.length; i += 5) {
            var astring = "<h3>" + gameFacts[i] + "</h3><form>"
            p = make_random(4);
            for (var x = 0; x < 4; x++) {
                var indx = i + p + 1;
                var correct = 0;
                if (p + 1 === 1) correct = 1;
                astring += '<input type="radio" ' + ' correct=' + correct + ' name="q" id=q' + indx + ' class="radio_click">';
                astring += gameFacts[indx] + " ";
                p++;
                if (p >= 4) p = 0;
            }
            astring += "</form>";
            $("#questions").append(astring);
        }

        function end_game() {
            var unanswered = 0;
            var correct = 0;
            var wrong = 0;
            // clean up vars
            clearInterval(intervalId);
            game_running = false;
            game_time = 59;
            $("#display").text("Time left: " + game_time);
            // go through each question and see if checked
            for (var i = 0; i < gameFacts.length; i += 5) {
                var checked = false;
                for (var x = 1; x < 5; x++) {
                    var indx = parseInt(i) + parseInt(x);
                    var query_string = "#q" + indx;
                    // console.log(query_string);
                    var q = $(query_string);
                    var is_checked = q.is(":checked");
                    var is_correct = q.attr("correct");
                    //console.log(is_checked);
                    // console.log(q.attr("correct"));
                    if (is_checked) {
                        checked = true;
                        // console.log("Set checked to true");
                        if (is_correct === "1") {
                            correct++;
                        } else {
                            wrong++;
                        }
                    }
                    q.prop("checked", false);
                }
                //console.log("done checked " + checked);
                if (!checked) {
                    unanswered++;
                }
            }
            $("#correct").text("Correct: " + correct);
            $("#incorrect").text("Misses: " + wrong);
            $("#notAnswered").text("Unanswered: " + unanswered);

        }

        // call back to finish
        $("#submit").click(function() {
            if (!game_running) {
                return;
            }
            end_game();
        });

        function countdown() {
            game_time--;
            $("#display").text(game_time);
            if (game_time === 0) {
                end_game();
            }
        }
        $(".radio_click").click(function() {
            if (!game_running) {
                game_running = true;
                intervalId = setInterval(function() {
                    countdown();
                }, 1000);
            }
        });
    </script>
</body>

</html>